name: 'Create release notes'
description: |
  Extracts release notes for current tag from CHANGELOG.md and writes them to a file called RELEASE.md.
  It is assumed that a header for RELEASE.md is found in the file RELEASE_HEAD.md.
inputs:
  version:
    description: 'Version number to search for in CHANGELOG.md (default: use tag without leading v)'
    required: false
    default: <tag version>
runs:
  using: "composite"
  steps:
    - name: Set env (default)
      if: ${{ version == "<tag version>" }}
      run: |
        RELEASE_VERSION_TEMP=${GITHUB_REF#refs/*/}
        echo "RELEASE_VERSION=${RELEASE_VERSION_TEMP#v}" >> $GITHUB_ENV

    - name: Set env (custom)
      if: ${{ version != "<tag version>" }}
      run: echo "RELEASE_VERSION=${{ version }}" >> $GITHUB_ENV

    - name: Extract changelog for release version
      # explanation of sed command:
      # 1. select lines between those starting with `## [x.y.z]` and `## `
      # 2. invert this selection
      # 3. delete it
      # => only selection is remaining in stream
      run: |
        cp RELEASE_HEAD.md RELEASE.md
        printf "\n" >> RELEASE.md
        sed -e "/^## \\[${RELEASE_VERSION:1}\\]/,/^## / ! d" CHANGELOG.md | head -n -2 >> RELEASE.md
